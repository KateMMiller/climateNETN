---
output: 
  html_document:
    fig_caption: yes
    css: webstyles.css
    anchor_sections: FALSE
    includes: 
      in_header: "header_manual.html" 
      after_body: "footer.html"
    self_contained: yes
title: "NETN climate summary"
params:
  year_current: 2024 # current year of data
---
# {.tabset .tabset-pills}

```{r echo = F, include = F, cache = F}
knitr::opts_chunk$set(echo = FALSE, fig.pos = "h", warning = FALSE, message = FALSE)
# Create environment for rmds to pull params from
library(tidyverse)
library(climateNETN)
library(leaflet)
library(grid)
library(gridExtra)

yr_current <- params$year_current
#park_list <- c("MIMA")

child_env <- new.env()

child_env$yr_current <- yr_current
child_env$lnetn_list <- c("BOHA", "MABI", "MIMA", "MORR", "ROVA", "SAGA", "SAIR", "SARA", "WEFA")  
```

```{r results = 'asis', include = F}
acad <- lapply(seq_along(c("ACAD")), function(x){
  child_env$park = "ACAD"
  knitr::knit_child("ACAD_summary.rmd", envir = child_env)
  #knitr::knit_child("About_tabs.Rmd", envir = child_env)
  })
```
```{r results = 'asis'}
cat(unlist(acad), sep = "\n\n")
```

```{r results = 'asis', include = F}
lnetn <- lapply(seq_along(child_env$lnetn_list), function(x){
  child_env$park = child_env$lnetn_list[[x]]
  knitr::knit_child("LNETN_park_summary.rmd", envir = child_env)
  #knitr::knit_child("About_tabs.Rmd", envir = child_env)
  
})
```
```{r results = 'asis'}
cat(unlist(lnetn), sep = "\n\n")
```

## About the Parks
```{r out.width="80%", message=F}
NPSbasic <- "https://atlas-stg.geoplatform.gov/styles/v1/atlas-user/ck58pyquo009v01p99xebegr9/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoiYXRsYXMtdXNlciIsImEiOiJjazFmdGx2bjQwMDAwMG5wZmYwbmJwbmE2In0.lWXK2UexpXuyVitesLdwUg"

ESRIimagery <- "http://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"

ESRItopo <- "http://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"

ESRINatGeo <- "http://services.arcgisonline.com/arcgis/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}"

bbox <- read.csv("boundboxes.csv") #lat/long coordinates and zoom level for each park 

# Find center coordinates of park box
data("NETN_centroids")
long_cent <- mean(c(bbox$LongE, bbox$LongW))
lat_cent <- mean(c(bbox$LatN, bbox$LatS))

# Compile water sites dataframe with codes, names, lat/long coordinates, and site type
parks <- NETN_centroids[,c("UnitCode", "UnitName", "long", "lat")]
head(parks)
parks$long[parks$UnitCode == "BOHA"] <- -70.94975
parks$lat[parks$UnitCode == "BOHA"] <- 42.31547
# Legend html generator
# Source: https://stackoverflow.com/questions/47064921/leaflet-legend-for-addawesomemarkers-function-with-icons
# Icon library changed from font-awesome to ion

# Create leaflet map
leaflet(height = 700) %>%
    # set default view of park
    setView(lng = long_cent,
            lat = lat_cent,
            zoom = 6) %>% #bbox$Zoom[bbox$ParkCode == park]) %>%
    # setMaxBounds(lng1 = bbox[bbox$ParkCode == parkcode,]$LongE,
    #              lng2 = bbox[bbox$ParkCode == parkcode,]$LongW,
    #              lat1 = bbox[bbox$ParkCode == parkcode,]$LatN,
    #              lat2 = bbox[bbox$ParkCode == parkcode,]$LatS) %>%
    # add map tiles
    addTiles(group="Map", urlTemplate = NPSbasic) %>% 
    addTiles(group="Imagery", urlTemplate = ESRIimagery) %>% 
    addTiles(group="Topo", urlTemplate = ESRItopo) %>% 
    addTiles(group="NatGeo", urlTemplate = ESRINatGeo) %>% 
  # add button to control map tiles
    addLayersControl(map = ., baseGroups = c("Map","Imagery","Topo", "NatGeo"),
                     options = layersControlOptions(collapsed=T)) %>%
    # add site markers 
    addMarkers(data = parks, ~long, ~lat, 
               # label on mouseover
               label=as.character(parks$UnitCode),
                      # popup on click
               popup = paste0("<b>", parks$UnitName, "</b><br>")
                      ) 

```


```{r child = "About_tabs.Rmd", eval = T}

```

```{r}
rm(list = ls())
```

